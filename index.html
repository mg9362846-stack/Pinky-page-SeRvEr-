<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VEER COOKIE SERVER PANEL</title>

<style>
body{margin:0;padding:0;background:#003366;color:white;font-family:Arial, sans-serif}
.container{width:95%;max-width:800px;margin:10px auto}
.card{background:rgba(255,255,255,0.12);padding:15px;margin-bottom:15px;border-radius:12px;box-shadow:0 0 8px rgba(0,0,0,0.3)}
.card h2{text-align:center;margin-top:0;font-size:1.2rem;border-bottom:1px solid rgba(255,255,255,0.2);padding-bottom:10px}
label{display:block;margin-top:10px;font-weight:bold;font-size:0.9rem}
input, button, select, textarea{width:100%;padding:12px;border-radius:8px;border:none;margin-top:6px;font-size:15px;box-sizing:border-box}
textarea{height:100px;resize:vertical;font-family:monospace;background:#f0f8ff;color:#000}
select{background:#eee;color:#000}
button{cursor:pointer;font-weight:bold}
.green{background:#00c853;color:white}
.red{background:#d50000;color:white}
#log{height:200px;overflow-y:auto;background:rgba(0,0,0,0.4);border-radius:8px;padding:10px;font-family:monospace;font-size:12px;white-space:pre-wrap}
.hidden{display:none}

.monitor-item{display:flex;justify-content:space-between;padding:6px 0}
.monitor-label{color:#00d2ff;font-weight:bold}
</style>
</head>

<body>
<div class="container">

<div class="card">
<h2>LIVE MONITOR</h2>
<div class="monitor-item"><span class="monitor-label">ðŸ•’ Uptime</span><span id="uptimeValue">0h 0m 0s</span></div>
<div class="monitor-item"><span class="monitor-label">ðŸš€ Active Tasks</span><span id="activeTasks">0</span></div>
<div class="monitor-item"><span class="monitor-label">ðŸ“¨ Messages Sent</span><span id="sent">0</span></div>
</div>

<div class="card">
<h2>START TASK</h2>

<label>Cookie Input Method</label>
<select id="cookieMethod" onchange="toggleCookieInput()">
<option value="file">Upload Cookie File</option>
<option value="paste">Paste Cookies</option>
</select>

<div id="fileInputArea">
<label>Cookie File</label>
<input type="file" id="cookieFile" accept=".txt">
</div>

<div id="pasteInputArea" class="hidden">
<label>Paste Cookies</label>
<textarea id="cookieText"></textarea>
</div>

<label>Message File</label>
<input type="file" id="msg" accept=".txt">

<label>Thread ID</label>
<input type="text" id="thread">

<label>Delay (sec)</label>
<input type="number" id="delay" value="10">

<label>Haters Name</label>
<input type="text" id="haters">

<label>Last Name</label>
<input type="text" id="last">

<button id="startBtn" class="green">START TASK</button>
</div>

<div class="card">
<h2>STOP TASK</h2>
<input type="text" id="taskIdInput" placeholder="Task ID">
<button id="stopBtn" class="red">STOP</button>
</div>

<div class="card">
<h2>LOG</h2>
<div id="log">Waiting...</div>
</div>

</div>

<script>
let ws;
const logBox = document.getElementById("log");

function log(msg){
  logBox.innerHTML += `[${new Date().toLocaleTimeString()}] ${msg}\n`;
  logBox.scrollTop = logBox.scrollHeight;
}

function toggleCookieInput(){
  const m=document.getElementById("cookieMethod").value;
  document.getElementById("fileInputArea").classList.toggle("hidden",m!=="file");
  document.getElementById("pasteInputArea").classList.toggle("hidden",m!=="paste");
}

/* ================= WEBSOCKET CONNECTION ================= */

function connect(){
  ws = new WebSocket(
    (location.protocol==="https:"?"wss://":"ws://")+location.host+"/ws"
  );

  ws.onopen = () => log("âœ… Connected to Server");

  ws.onclose = () => {
    log("âš ï¸ Connection Lost, reconnecting...");
    setTimeout(connect,3000);
  };

  ws.onmessage = (e)=>{
    let d;
    try{ d=JSON.parse(e.data); }catch{ return; }

    if(d.type==="log") log(d.message);

    if(d.type==="task_started"){
      log(`ðŸš€ Task started | ID: ${d.taskId}`);
      document.getElementById("taskIdInput").value=d.taskId;
    }

    if(d.type==="stopped"){
      log(`â¹ Task stopped | ID: ${d.taskId}`);
    }

    if(d.type==="monitor_data"){
      // --- Formatting Uptime to H:M:S ---
      const totalSeconds = d.uptime;
      const hours = Math.floor(totalSeconds / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;

      document.getElementById("uptimeValue").textContent = `${hours}h ${minutes}m ${seconds}s`;
      document.getElementById("activeTasks").textContent = d.activeTasks;
      document.getElementById("sent").textContent = d.totalSent;
    }
  };
}

/* ðŸ” PING TO KEEP CONNECTION ALIVE */
setInterval(()=>{
  if(ws && ws.readyState===1){
    ws.send(JSON.stringify({type:"ping"}));
  }
},25000);

/* ðŸ” REQUEST MONITOR DATA */
setInterval(()=>{
  if(ws && ws.readyState===1){
    ws.send(JSON.stringify({type:"monitor"}));
  }
},2000);

/* ================= START TASK LOGIC ================= */

document.getElementById("startBtn").onclick=()=>{
  const msgFileInput = document.getElementById("msg");
  const threadInput = document.getElementById("thread");
  const delayInput = document.getElementById("delay");
  const hatersInput = document.getElementById("haters");
  const lastInput = document.getElementById("last");

  const msgFile = msgFileInput.files[0];
  if(!msgFile) return alert("Please select a message file");

  const method = document.getElementById("cookieMethod").value;

  const sendTask = (cookies) => {
    const reader = new FileReader();
    reader.onload = (e) => {
      ws.send(JSON.stringify({
        type: "start",
        cookieContent: cookies,
        messageContent: e.target.result,
        threadID: threadInput.value,
        delay: delayInput.value,
        hatersName: hatersInput.value,
        lastHereName: lastInput.value
      }));
      log("â³ Sending task request...");
    };
    reader.readAsText(msgFile);
  };

  if(method === "file"){
    const f = document.getElementById("cookieFile").files[0];
    if(!f) return alert("Please upload a cookie file");
    const r = new FileReader();
    r.onload = e => sendTask(e.target.result);
    r.readAsText(f);
  } else {
    const pText = document.getElementById("cookieText").value;
    if(!pText.trim()) return alert("Please paste cookies");
    sendTask(pText);
  }
};

/* ================= STOP TASK LOGIC ================= */

document.getElementById("stopBtn").onclick=()=>{
  const id = document.getElementById("taskIdInput").value;
  if(!id) return alert("Enter Task ID to stop");
  if(ws && ws.readyState===1){
    ws.send(JSON.stringify({type:"stop_by_id", taskId:id}));
  }
};

// Initialize Connection
connect();
</script>
</body>
</html>